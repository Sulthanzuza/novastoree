<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="preload" href="/cover.webp" as="image">
<link rel="preload" href="/lumin-1mp7rF7_j2I-unsplash (2).jpg" as="image">
<link rel="preload" href="/reuben-mansell-nwOip8AOZz0-unsplash (1).jpg" as="image">
<title>{{title}}</title>
<link rel="stylesheet" href="/home.css">

{{>header}}
<section id="newArrivalsCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="3000">
      <div class="new-arrivals" style="background-image: url('/cover.webp');">
        <div class="content text-center">
          <h2>New Arrivals</h2>
          <p>Discover Our Newest Arrivals Today.</p>
          <a href="/list-products" class="btnn">View More <span>→</span></a>
        </div>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="3000">
      <div class="new-arrivals" style="background-image: url('/lumin-1mp7rF7_j2I-unsplash (2).jpg');">
        <div class="content text-center">
          <h2>Invest in your skin, it's the only one you've got.</h2>
        </div>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="3000">
      <div class="new-arrivals" style="background-image: url('/reuben-mansell-nwOip8AOZz0-unsplash (1).jpg');">
        <div class="content text-center">
          <h2>Glow is the result of healthy skin, inside and out</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Carousel Controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#newArrivalsCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#newArrivalsCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</section>

<div class="main">
  <section class="features-grid" aria-label="Features">
    <article class="feature-item">
      <div class="feature-icon-wrapper">
        <div class="feature-icon">
          <img
            src="https://cdn.builder.io/api/v1/image/assets/TEMP/ef5bf39235eea2b89da858d8ed6aef3fb129947fa47efcbde59795eb248ff3ec?placeholderIfAbsent=true&apiKey=d7cebeeadab64378ab4fc611373387df"
            alt="Free shipping icon" />
        </div>
      </div>
      <h2 class="feature-title">Free Shipping</h2>
      <p class="feature-description">Upgrade your style today and get FREE shipping on all orders! Don't miss out.</p>
    </article>

    <article class="feature-item">
      <div class="feature-icon-wrapper">
        <div class="feature-icon">
          <img
            src="https://cdn.builder.io/api/v1/image/assets/TEMP/6cc1355f4805f0bea4a20fa9d89fdcfb5e71c7ce245100e1a805f4a9b4f582ee?placeholderIfAbsent=true&apiKey=d7cebeeadab64378ab4fc611373387df"
            alt="Satisfaction guarantee icon" />
        </div>
      </div>
      <h2 class="feature-title">Satisfaction Guarantee</h2>
      <p class="feature-description">Shop confidently with our Satisfaction Guarantee: Love it or get a refund.</p>
    </article>

    <article class="feature-item">
      <div class="feature-icon-wrapper">
        <div class="feature-icon">
          <img
            src="https://cdn.builder.io/api/v1/image/assets/TEMP/200f415549389945204e87e86db9768d85bfeb01ebb8c4a5853ae7a194a80e04?placeholderIfAbsent=true&apiKey=d7cebeeadab64378ab4fc611373387df"
            alt="Secure payment icon" />
        </div>
      </div>
      <h2 class="feature-title">Secure Payment</h2>
      <p class="feature-description">Your security is our priority. Your payments are secure with us.</p>
    </article>
  </section>


  <section class="best-sellers-section" aria-label="Best Selling Products">
    <h2 class="section-title">Best Selling</h2>
    <div class="prods">
      <div class="row products-grid">
        {{#each products}}
        <div class="col-md-2 col-sm-4 col-6">
          <article class="product-card">
            <div class="product-image-wrapper image-container">
              <a href="/product/{{this._id}}/{{this.variants.[0]._id}}">
                <img loading="lazy" src="/uploads/{{this.image.[0]}}" alt="{{this.name}}"
                  class="product-image image-0" />
                <img loading="lazy" src="/uploads/{{this.image.[1]}}" alt="{{this.name}}"
                  class="product-image image-1" />
                <button class="add-to-cart">Product Details</button>
              </a>
              <button class="wishlist-btn" data-product="{{this._id}}" data-variant="{{this.variants.[0]._id}}">
                {{#if (lookup ../wishlistProductIds this.variants.[0]._id)}}
                <i class="bi bi-heart-fill" style="color: red;"></i>
                {{else}}
                <i class="bi bi-heart" style="color: black;"></i>
                {{/if}}
              </button>
              {{#if this.variants.[0].discountPercentage}}
              <div class="discount-label">
                <i class="bi bi-tag"></i> {{this.variants.[0].discountPercentage}}% OFF
              </div>
              {{/if}}
            </div>
            <div class="product-details">
              <div class="product-info">
                <h3 class="product-name">
                  {{this.name}}
                </h3>
                <div class="product-price-wrapper">
                  <span class="stock-badge">
                    {{#if this.variants.[0].stockStatus}}
                    {{this.variants.[0].stockStatus}}
                    {{else}}
                    IN STOCK
                    {{/if}}
                  </span>
                  <div class="price">
                    {{#if this.variants.[0].discountedPrice}}
                    {{#if (neq this.variants.[0].discountedPrice this.variants.[0].price)}}

                    <span class="product-price discounted-price">₹{{this.variants.[0].discountedPrice}}</span>
                    {{else}}
                    <span class="product-price">₹{{this.variants.[0].price}}</span>
                    {{/if}}
                    {{else}}
                    <span class="product-price">₹{{this.variants.[0].price}}</span>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
          </article>
        </div>
        {{/each}}
      </div>

    </div>
  </section>




  <section class="best-sellers-sectionnn" aria-label="Categories">
    <h2 class="section-title text-center" style="color: #000000; 
  text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3); 
  font-weight: bold; 
  text-transform: uppercase;">Categories</h2>
    <div class="categories-section">
      {{#each categories}}
      <div class="category-box">
        <p>{{this.name}}</p>
        <img src="/uploads/{{this.icon}}" alt="{{this.name}} Icon" class="category-icon" />
      </div>
      {{/each}}
    </div>
  </section>

  <div class="trending">
    <h3>Trending Today</h3>
  </div>

  <section class="best-sellers-section" aria-label="Trending Products">
    <div class="prods">
      <div class="row products-grid">
        {{#each trendingProducts}}
        <div class="col-md-2 col-sm-4 col-6">
          <article class="product-card">
            <div class="product-image-wrapper image-container">
              <a href="/product/{{this._id}}/{{this.variants.[0]._id}}">
                <img loading="lazy" src="/uploads/{{this.image.[0]}}" alt="{{this.name}}"
                  class="product-image image-0" />
                <img loading="lazy" src="/uploads/{{this.image.[1]}}" alt="{{this.name}}"
                  class="product-image image-1" />
                <button class="add-to-cart">Product Details</button>
              </a>

              <!-- Wishlist button inside the image wrapper -->
              <button class="wishlist-btn" data-product="{{this._id}}" data-variant="{{this.variants.[0]._id}}">
                {{#if (lookup ../wishlistProductIds this.variants.[0]._id)}}
                <i class="bi bi-heart-fill" style="color: red;"></i>
                {{else}}
                <i class="bi bi-heart"></i>
                {{/if}}
              </button>
              {{#if this.variants.[0].discountPercentage}}
              <div class="discount-label">
                <i class="bi bi-tag"></i> {{this.variants.[0].discountPercentage}}% OFF
              </div>
              {{/if}}
            </div>
            <div class="product-details">
              <div class="product-info">
                <h3 class="product-name">{{this.name}}</h3>
                <div class="product-price-wrapper">
                  <span class="stock-badge">
                    {{#if this.variants.[0].stockStatus}}
                    {{this.variants.[0].stockStatus}}
                    {{else}}
                    IN STOCK
                    {{/if}}
                  </span>
                  <div class="price">
                    {{#if this.variants.[0].discountedPrice}}
                    {{#if (neq this.variants.[0].discountedPrice this.variants.[0].price)}}

                    <span class="product-price discounted-price">₹{{this.variants.[0].discountedPrice}}</span>
                    {{else}}
                    <span class="product-price">₹{{this.variants.[0].price}}</span>
                    {{/if}}
                    {{else}}
                    <span class="product-price">₹{{this.variants.[0].price}}</span>
                    {{/if}}
                  </div>
                </div>
              </div>
            </div>
          </article>
        </div>
        {{/each}}
      </div>

    </div>
  </section>


  {{>footer}}
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script>
   document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.wishlist-btn').forEach(button => {
      button.addEventListener('click', async function () {
        const productId = this.getAttribute('data-product');
        const variantId = this.getAttribute('data-variant');
        const icon = this.querySelector('i');

        const response = await fetch('/wishlist/add-product', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId: productId, variantId: variantId })
        });

        const result = await response.json();
        if (result.success) {
          Swal.fire({
            icon: 'success',
            title: result.message,
            confirmButtonText: 'OK'
          });

          // Toggle heart icon fill and color
          icon.classList.toggle('bi-heart-fill');
          icon.classList.toggle('bi-heart');
          icon.style.color = result.message.includes('Added') ? 'red' : 'black';
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: result.message,
            confirmButtonText: 'OK'
          });
        }
      });
    });
  });
</script>